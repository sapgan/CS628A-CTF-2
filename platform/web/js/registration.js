// Generated by CoffeeScript 1.12.5
(function() {
  var recaptchaPublicKey, reloadCaptcha, setRequired, submitRegistration;

  recaptchaPublicKey = "";

  reloadCaptcha = function() {
    return apiCall("GET", "/api/user/status", {}).done(function(data) {
      console.log(data.data.enable_captcha);
      if (data.data.enable_captcha) {
        grecaptcha.reset();
      }
      return ga('send', 'event', 'Registration', 'NewCaptcha');
    });
  };

  setRequired = function() {
    return $('#user-registration-form :input').each(function() {
      if (!$(this).is(':checkbox')) {
        if (!$(this).is(':radio')) {
          return $(this).prop('required', $(this).is(":visible"));
        }
      }
    });
  };

  submitRegistration = function(e) {
    var creatingNewTeam, creatingTeacherAccount, logType, registrationData, submitButton;
    e.preventDefault();
    registrationData = $("#user-registration-form").serializeObject();
    creatingNewTeam = $("#registration-new-team-page").is(":visible");
    creatingTeacherAccount = $("#registration-adviser-page").is(":visible");
    registrationData["create-new-team"] = creatingNewTeam;
    registrationData["create-new-teacher"] = creatingTeacherAccount;
    if (creatingNewTeam) {
      registrationData["ctf-emails"] = $("#checkbox-emails-create").is(':checked');
      submitButton = "#register-button-create";
      logType = "NewTeam";
    } else if (creatingTeacherAccount) {
      registrationData["ctf-emails"] = $("#checkbox-emails-teacher").is(':checked');
      submitButton = "#register-button-teacher";
      logType = "NewTeacher";
    } else {
      registrationData["ctf-emails"] = $("#checkbox-emails-existing").is(':checked');
      submitButton = "#register-button-existing";
      logType = "JoinTeam";
    }
    return apiCall("POST", "/api/user/create", registrationData).done(function(data) {
      switch (data['status']) {
        case 0:
          $(submitButton).apiNotify(data, {
            position: "right"
          });
          ga('send', 'event', 'Registration', 'Failure', logType + "::" + data.message);
          return grecaptcha.reset();
        case 1:
          ga('send', 'event', 'Registration', 'Success', logType);
          if (creatingTeacherAccount) {
            return document.location.href = "/classroom";
          } else {
            return document.location.href = "/team";
          }
      }
    });
  };

  $(function() {
    var offset, pageTransitionSpeed;
    apiCall("GET", "/api/user/status", {}).done(function(data) {
      if (data.data.enable_captcha) {
        return grecaptcha.render("captcha", {
          "sitekey": recaptchaPublicKey
        });
      }
    });
    $("#user-registration-form").on("submit", submitRegistration);
    $("#registration-new-team-page").hide();
    $("#registration-join-team-page").hide();
    $("#registration-adviser-page").hide();
    pageTransitionSpeed = 200;
    offset = 0;
    $("#button-new-team").click(function() {
      return $("#registration-join-team-page").hide("slide", {
        direction: "up"
      }, pageTransitionSpeed, function() {
        return $("#registration-adviser-page").hide("slide", {
          direction: "up"
        }, pageTransitionSpeed, function() {
          return $("#registration-new-team-page").show("slide", {
            direction: "up"
          }, pageTransitionSpeed, function() {
            ga('send', 'event', 'Registration', 'Switch', 'NewTeam');
            return setRequired();
          });
        });
      });
    });
    $("#button-join-team").click(function() {
      return $("#registration-new-team-page").hide("slide", {
        direction: "up"
      }, pageTransitionSpeed, function() {
        return $("#registration-adviser-page").hide("slide", {
          direction: "up"
        }, pageTransitionSpeed, function() {
          return $("#registration-join-team-page").show("slide", {
            direction: "up"
          }, pageTransitionSpeed, function() {
            ga('send', 'event', 'Registration', 'Switch', 'JoinTeam');
            return setRequired();
          });
        });
      });
    });
    return $("#button-adviser").click(function() {
      return $("#registration-new-team-page").hide("slide", {
        direction: "up"
      }, pageTransitionSpeed, function() {
        return $("#registration-join-team-page").hide("slide", {
          direction: "up"
        }, pageTransitionSpeed, function() {
          return $("#registration-adviser-page").show("slide", {
            direction: "up"
          }, pageTransitionSpeed, function() {
            ga('send', 'event', 'Registration', 'Switch', 'Teacher');
            return setRequired();
          });
        });
      });
    });
  });

}).call(this);
